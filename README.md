# 在对数据正式进行清洗以前，需要强调我们对原始数据进行了统一变量名和所属行业代码的预处理：
## 首先是变量名称统一
由于原始数据中大多数数据名称为v1、v2…形式，难以辨识，同时不同年份数据之间的变量数量也不尽相同，因此需要根据数据说明表对各变量名称进行统一。具体结果请参见“20230926-税调变量名称统一.xlsx”文件，具体匹配程序请参见“税调企业碳排放测算-step0 统一变量名称”文件夹。
注：由于更新了2017-2020年的税调数据，所以请重点参考“税调企业碳排放测算-step0 统一变量名称”文件夹中的代码。
## 其次是数据初步剔除
考虑到我们大多研究主要是围绕能源环境问题展开，所以我们先依据原始数据中企业的能源消费量（煤、油、电、天然气和其他气体燃料）进行初步剔除，删除所有能源消费数据均未汇报的观测样本，以及能源数据中存在负数的观测样本。具体程序请参见“税调企业碳排放测算-step1 初步剔除.do”。
## 再次是工商数据库匹配
此举是为了更好地实现税调数据与其他数据库（专利、工企、土地出让、海关、污染排放…）的互联互通。我们希望将统一社会信用代码和企业工商注册名称作为日后与其他数据库进行匹配的唯二依据。
具体而言，我们先对税调数据库中“id”和“qymc（企业名称）”两个字段进行清理。其中，id主要由15位（6位区划代码+9位组织机构代码）及18位（统一社会信用代码，2位类型码+6位区划代码+9位组织机构代码+1位校验码）构成，我们在清洗过程中统一为11位代码（qyid，2位省级区划代码+9位组织机构代码），具体程序请参见“税调企业碳排放测算-step1 字段生成.do”。企业名称的清晰思路可以参见“税调企业碳排放测算-step2.1 数据匹配.do”“工商数据库预处理过程”（文件夹，原始数据链接https://pan.baidu.com/s/1DqtLea7a1_Pn6XTnJ6L0zg?pwd=webt）。
进一步地，我们先根据qyid变量与工商数据库（库中包含18位统一社会信用代码，我们也将之清洗为11位代码）进行匹配，将匹配失败的观测样本用qymc变量再进行二次匹配。具体运行程序请参见“税调企业碳排放测算-step2 数据匹配.do”“税调企业碳排放测算-step2 工商匹配.do”。
## 接着是所属行业代码及行政区划代码统一
参考田彬彬等（2020）的做法，我们将税调原始数据中“industry（对应2007）”“hylb（2008-2011）”视为CIC2002版本，并统一转换为CIC2011版本（该版本于2012年正式使用）。具体转换代码请参见“2011版统一为2002版stata代码do文件.do”，实际在“税调企业碳排放测算-step3 折算碳排放因子_行业和区域.do”中运行。
注：由于数据已经扩充至2020年，我们还需要将2017年版的行业代码统一至2011年版，具体数据请参见“Plus Step1 Data 2017版统一为2011版对照表.dta”。
此外，我们采用折算系数法对企业碳排放量进行测算，具体思路请见下文“二、碳排放核算方法”，具体程序请参见“税调企业碳排放测算-step3 碳排放折算系数.py”“税调企业碳排放测算-step Plus 合并.do”。
注：由于官方公布的电网平均碳排放因子数据时效性和颗粒度较差（仅有2010、2011、2012及2021年以后的相关数据），我参考了一篇2005-2021年省级电网平均碳排放因子的测算论文（请参见“$2005—2021年区域和省级电网碳排放因子研究”）。另外，由于作者不愿意分享具体的测算结果，我采用了邪道做法，用Origin软件提取了图中的具体数值，具体请参见“$2005-2020年省级电网平均碳排放因子”
## 最后处理步骤
为了方便大家对税调企业进行更多的拓展性分析，我们首先将各个年份的数据进行了合并，具体参见“税调企业碳排放测算-step Plus 合并.do”。此外，我们还基于企业工商注册地址和企业名称，运用高德地图api对企业的所处省份、城市、区县和经纬度坐标进行解析。具体程序请参见“税调企业-注册地址查询.py”。同时，我们结合碳排放栅格数据，依次提取了税调企业周围1~5km范围内的二氧化碳排放量之和。具体程序可以参见“提取点周围的栅格值.R”（该方法也在后文有具体说明）。
